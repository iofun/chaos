<!DOCTYPE html>
<html lang="en">
<head>
          <title>Spacebeam: Distributed Artificial Intelligence</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Spacebeam: Distributed Artificial Intelligence Full Atom Feed" />
        <link href="/feeds/updates.atom.xml" type="application/atom+xml" rel="alternate" title="Spacebeam: Distributed Artificial Intelligence Categories Atom Feed" />
        <!-- twitter card metadata -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/logo.png">
<meta name="twitter:site" content="@SpacebeamOrg">
<meta name="twitter:title" content="Gathering Minerals to someday Build a Refinery and extract Vespene Gas">
<meta name="twitter:description" content="Let's learn to order our workers to gather some resources closest to them!">
        <!-- OG Tags -->
<meta property="og:url" content="/2020/07/10/gathering-minerals-to-someday-build-a-refinery-and-extract-vespene-gas/"/>
<meta property="og:title" content="Spacebeam: Distributed Artificial Intelligence | Gathering Minerals to someday Build a Refinery and extract Vespene Gas" />
<meta property="og:description" content="Let's learn to order our workers to gather some resources closest to them!" />
        <!-- favicon -->
        <link rel="icon" type="image/png" href="/images/logo.png">
        <!-- moment.js for date formatting -->
        <script src="/theme/js/moment.js"></script>
        <!-- css -->
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
		<script>
			
                /*! grunt-grunticon Stylesheet Loader - v2.1.2 | https://github.com/filamentgroup/grunticon | (c) 2015 Scott Jehl, Filament Group, Inc. | MIT license. */
    
    (function(e){function t(t,n,r,o){"use strict";function a(){for(var e,n=0;u.length>n;n++)u[n].href&&u[n].href.indexOf(t)>-1&&(e=!0);e?i.media=r||"all":setTimeout(a)}var i=e.document.createElement("link"),l=n||e.document.getElementsByTagName("script")[0],u=e.document.styleSheets;return i.rel="stylesheet",i.href=t,i.media="only x",i.onload=o||null,l.parentNode.insertBefore(i,l),a(),i}var n=function(r,o){"use strict";if(r&&3===r.length){var a=e.navigator,i=e.Image,l=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||e.opera&&-1===a.userAgent.indexOf("Chrome")||-1!==a.userAgent.indexOf("Series40")),u=new i;u.onerror=function(){n.method="png",n.href=r[2],t(r[2])},u.onload=function(){var e=1===u.width&&1===u.height,a=r[e&&l?0:e?1:2];n.method=e&&l?"svg":e?"datapng":"png",n.href=a,t(a,null,null,o)},u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",document.documentElement.className+=" grunticon"}};n.loadCSS=t,e.grunticon=n})(this);(function(e,t){"use strict";var n=t.document,r="grunticon:",o=function(e){if(n.attachEvent?"complete"===n.readyState:"loading"!==n.readyState)e();else{var t=!1;n.addEventListener("readystatechange",function(){t||(t=!0,e())},!1)}},a=function(e){return t.document.querySelector('link[href$="'+e+'"]')},c=function(e){var t,n,o,a,c,i,u={};if(t=e.sheet,!t)return u;n=t.cssRules?t.cssRules:t.rules;for(var l=0;n.length>l;l++)o=n[l].cssText,a=r+n[l].selectorText,c=o.split(");")[0].match(/US\-ASCII\,([^"']+)/),c&&c[1]&&(i=decodeURIComponent(c[1]),u[a]=i);return u},i=function(e){var t,o,a;o="data-grunticon-embed";for(var c in e)if(a=c.slice(r.length),t=n.querySelectorAll(a+"["+o+"]"),t.length)for(var i=0;t.length>i;i++)t[i].innerHTML=e[c],t[i].style.backgroundImage="none",t[i].removeAttribute(o);return t},u=function(t){"svg"===e.method&&o(function(){i(c(a(e.href))),"function"==typeof t&&t()})};e.embedIcons=i,e.getCSS=a,e.getIcons=c,e.ready=o,e.svgLoadedCallback=u,e.embedSVG=u})(grunticon,this);
                
                grunticon(["/theme/css/icons.data.svg.css", "/theme/css/icons.data.png.css", "/theme/css/icons.fallback.css"]);
            </script>
        <noscript><link href="/theme/css/icons.fallback.css" rel="stylesheet"></noscript>
        <!-- menu toggle javascript -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", initMenu);
            
            function initMenu(){
                var menu = document.getElementById("menu");
                var menulink = document.getElementById("menu-link");
                menulink.addEventListener("click", function toggleMenu(){
                        window.event.preventDefault();
                        menulink.classList.toggle('active');
                        menu.classList.toggle('active');              
                    });
            };
        </script>

    <meta name="description" content="Let's learn to order our workers to gather some resources closest to them!" />


</head>
<body>
    <div role="banner" id="masthead">
        <header>
            <a href="/"><img src="/images/logo.png" alt="McManus Logo"></a>
            <a href="#menu" id="menu-link">more stuff</a>
            <nav id="menu">
                <ul>
                        <li><a href="/pages/about/">about</a></li>
                        <li><a href="/pages/research/">research</a></li>
                        <li><a href="/pages/technology/">technology</a></li>
                            <li class="active"><a href="/category/updates">updates</a></li>
                </ul>
            </nav>
        </header>
    </div>
        <div class="page" role="main">
  <div class="article" role="article">
    <article>
        <footer>
            <a name="top"></a>
            <p>
              <time datetime=" 2020-07-10 00:00:00+02:00">
                <script>document.write(moment('2020-07-10 00:00:00+02:00').format('LL'));</script>
              </time>
            </p>
        </footer>
        <header>
          <h2>
            Gathering Minerals to someday Build a Refinery and extract Vespene Gas
          </h2>
        </header>
      <div class="content">
         <p>TorchCraft is a BWAPI module that sends StarCraft: Brood War data out over a ZMQ connection.
This lets you parse StarCraft data and interact with BWAPI from anywhere.</p>
<p>This tutorial will walk you through execute the game for the first time after <a href="https://spacebeam.org/2020/07/09/how-to-install-torchcraft-and-set-up-a-programming-environment-on-linux/">installing the environment</a>,
we are going to dive into TorchCraft example.py and start gathering minerals to someday extract vespene gas.</p>
<p>Let's start the game and learn a bit more about TorchCraft!</p>
<div class="highlight"><pre><span></span>cd /opt/StarCraft
</pre></div>


<div class="highlight"><pre><span></span>wine bwheadless.exe -e /opt/StarCraft/StarCraft.exe\
 -l /opt/StarCraft/bwapi-data/BWAPI.dll --host\
 --name blueberry --game blueberry --race T\
 --map maps/TorchUp/\(4\)FightingSpirit1.3.scx&amp;\
wine Chaoslauncher/Chaoslauncher.exe
</pre></div>


<p>That is what we are actually executing, let's build a <code>launcher.py</code> script.</p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Run bwheadless.exe and Chaoslauncher.exe from here!</span>

<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;host a game with bwheadless&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s1">&#39;--path&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;/opt/StarCraft/&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;StarCraft path&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;--bot&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;blueberry&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;--race&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Terran&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;--map&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s1">&#39;\(4\)FightingSpirit1.3.scx&#39;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

<span class="n">execute</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">wine bwheadless.exe -e {0}StarCraft.exe</span><span class="se">\</span>
<span class="s1"> -l {0}bwapi-data/BWAPI.dll --host</span><span class="se">\</span>
<span class="s1"> --name {1} --game {1} --race {2}</span><span class="se">\</span>
<span class="s1"> --map maps/TorchUp/{3}&amp;</span><span class="se">\</span>
<span class="s1">wine Chaoslauncher/Chaoslauncher.exe</span>
<span class="s1">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">race</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">execute</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>


<p>Let's test the original examples again and start <code>launcher.py</code> to see what gives?</p>
<h3>Run the original <code>example.py</code></h3>
<div class="highlight"><pre><span></span>$ python3 /usr/src/TorchCraft/examples/py/example.py -t <span class="m">127</span>.0.0.1
</pre></div>


<h3>Run the <code>launcher.py</code> script</h3>
<div class="highlight"><pre><span></span>$ python3 /usr/src/starcraft-sif/examples/launcher.py
</pre></div>


<p>If everything works as expected, you will see Chaoslauncher, the first time it will ask for the location of <code>StarCraft.exe</code>, you will find it on <code>/opt/StarCraft/</code> confirm, it will ask probably to restart <code>Chaoslauncher.exe</code>, kill the current session with <code>Control-C</code> in the terminal where you start <code>launcher.py</code> and run it again.</p>
<div class="highlight"><pre><span></span>$ python3 /usr/src/starcraft-sif/examples/launcher.py
</pre></div>


<p>Now with Chaoslauncher ready, enable the <code>BWAPI 4.2.0 Injector [RELEASE]</code> and and <code>W-MODE</code> plugins and click on <code>Start</code> hopefully that will launch the game on your new environment, Check <code>Multiplayer -&gt; Local PC</code> and confirm that you see a <code>blueberry</code> waiting in the lobby.</p>
<h2>What is TorchCraft again?</h2>
<p>TorchCraft is a library that enables deep learning research in the real-time strategy game of StarCraft: Brood War, by making easier to control the game from a machine learning framework, here Torch.</p>
<p>The goal of the StarCraft player is to collect resources which can be used to expand their control on the map, create buildings and units to fight off enemy deployments, and ultimately destroy the opponents.</p>
<p>These games exhibit durative moves with complex game dynamics with simultaneous actions where all players can give commands to any of their units at any time, and partial observability (a "fog of war": opponent units not in the vicinity of a player's units are not shown).</p>
<p>Each unit and building has range of sight that provides the player with a view of the map. Parts of the map not in the sight range of the player's units are under fog of war and the player cannot observe what happens there. A considerable part of the strategy and the tactics lies in which units to deploy and where.</p>
<p>An <code>opening</code> denotes the same thing as in Chess: an early game plan for which the player has to make choices. That is the case in Chess because on can move only one piece at a time (each turn), and in RTS games because, during the development phase, one is economically limited and has to choose which tech paths to pursue.</p>
<p>Available resources constrain the technology advancements and the number of units one can produce. As producing buildings and units also take time, the arbitrage between investing in the economy, in tecnological advancement, and in units production is the crux of the strategy during the whole game.</p>
<p>TorchCraft advocate to have not only the pixels as input and keyboard/mouse for commands, but also a structured representation of the game state..</p>
<div class="highlight"><pre><span></span><span class="c1">-- main game engine loop:</span>
<span class="c1">-- illustrates the DLL that gets into the game engine as a BWAPI bot</span>
<span class="c1">-- it acts as the server for our TorchCraft bot client to `connect`, `receive` and `send(commands)`</span>
<span class="kr">while</span> <span class="kc">true</span> <span class="kr">do</span>
    <span class="n">game</span><span class="p">.</span><span class="n">receive_player_actions</span><span class="p">()</span>
    <span class="n">game</span><span class="p">.</span><span class="n">compute_dynamics</span><span class="p">()</span>
    <span class="c1">-- our injected code:</span>
    <span class="n">torchcraft</span><span class="p">.</span><span class="n">send_state</span><span class="p">()</span>
    <span class="n">torchcraft</span><span class="p">.</span><span class="n">receive_actions</span><span class="p">()</span>
<span class="kr">end</span>
</pre></div>


<p>A simplified client/server model that runs in the game engine (server, on top) and the machine learning framework (client, on the bottom).</p>
<div class="highlight"><pre><span></span><span class="c1">-- ilustrates a TorchCraft bot using the Lua client to `connect`, `receive` and `send(commands)`</span>
<span class="c1">-- it acts as the machine learning client where we integrate Torch to return in-game actions</span>
<span class="n">tc</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s1">&#39;torchcraft&#39;</span><span class="p">)</span>
<span class="n">featurize</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">init</span><span class="p">()</span>
<span class="n">tc</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
<span class="kr">while</span> <span class="ow">not</span> <span class="n">tc</span><span class="p">.</span><span class="n">state</span><span class="p">.</span><span class="n">game_ended</span> <span class="kr">do</span>
    <span class="n">tc</span><span class="p">:</span><span class="n">receive</span><span class="p">()</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">featurize</span><span class="p">(</span><span class="n">tc</span><span class="p">.</span><span class="n">state</span><span class="p">)</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">model</span><span class="p">:</span><span class="n">forward</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    <span class="n">tc</span><span class="p">:</span><span class="n">send</span><span class="p">(</span><span class="n">tc</span><span class="p">:</span><span class="n">tocommand</span><span class="p">(</span><span class="n">actions</span><span class="p">))</span>
<span class="kr">end</span>
</pre></div>


<p>This makes it easier to try a broad variety of models, and may be useful in shaping loss functions for pixel-based models.</p>
<p>StarCraft: Brood War is a highly competitive game with professional players, which provides interesting datasets, human feedback, and a good benchmark of what is possible to achieve within the game.</p>
<h3>TorchCraft Design</h3>
<p>TorchCraft connects Torch to BWAPI low level interface to StarCraft: Brood War. TorchCraft's approach is to dynamically inject a piece of code in the game engine that will be a server. This server sends the state of the game to a client, and receives commands to send to the game.</p>
<p>The two modules are entirely asynchronous. TorchCraft execution moduel inject a DLL that provides the game interface to the bots, and one that includes all the instructions to communicate with the external client, interpreted by the game as player (or bot AI).</p>
<p>The server starts at the beginning of the match and shuts down when that ends.</p>
<p>TorchCraft is seen by the AI programmer as a library that provides: <code>connect()</code>, <code>receive()</code> to get the state, <code>send(commands)</code>, and some helper functions about specifics of StarCraft's rules and state representation.</p>
<p>TorchCraft also provides an efficient way to store game frames data from past games so that existing replays can be re-examined.</p>
<p>We believe that an efficient bridge between BWAPI and machine learning frameworks would enable and foster research on such games.</p>
<p>TorchCraft is a library that enables state-of-the-art machine learning reserch on real game data by interfacing Torch with StarCraft: Brood War.</p>
<h3>A frame data</h3>
<p>In addition to the visual data, the TorchCraft server extracts certain information for the game state and sends it over to the connected clients in a structured "frame".</p>
<p>The frame is formatted in a table in roughly the following structure:</p>
<div class="highlight"><pre><span></span><span class="nx">received_update</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// Number of frames in the current game</span>
    <span class="nx">frame_from_bwapi</span><span class="o">:</span> <span class="kr">int</span>
    <span class="nx">units_myself</span><span class="o">:</span> <span class="p">{</span>
        <span class="c1">// Unit ID</span>
        <span class="kr">int</span><span class="o">:</span> <span class="p">{</span>
            <span class="c1">// Unit ID</span>
            <span class="nx">target</span><span class="o">:</span> <span class="kr">int</span>
            <span class="nx">targetpos</span><span class="o">:</span> <span class="p">{</span>
                <span class="c1">// Absolute x</span>
                <span class="mi">1</span><span class="o">:</span> <span class="kr">int</span>
                <span class="c1">// Absolute y</span>
                <span class="mi">2</span><span class="o">:</span> <span class="kr">int</span>
            <span class="p">}</span>
            <span class="c1">// Type of air weapon</span>
            <span class="nx">awtype</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Type of ground weapon</span>
            <span class="nx">gwtype</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Frames before next air weapon attack</span>
            <span class="nx">awcd</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Number of hit points</span>
            <span class="nx">hp</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Number of energy points, if any</span>
            <span class="nx">energy</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Unit type</span>
            <span class="nx">type</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Position</span>
            <span class="nx">position</span><span class="o">:</span> <span class="p">{</span>
                <span class="c1">// Absolute x</span>
                <span class="mi">1</span><span class="o">:</span> <span class="kr">int</span>
                <span class="c1">// Absolute y</span>
                <span class="mi">2</span><span class="o">:</span> <span class="kr">int</span>
            <span class="p">}</span>
            <span class="c1">// Number of armor points</span>
            <span class="nx">armor</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Frames before next ground weapon attack</span>
            <span class="nx">gwcd</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Ground weapon attack damae</span>
            <span class="nx">gwattack</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Protoss shield points</span>
            <span class="nx">shield</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Air weapon attack damage</span>
            <span class="nx">awattack</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Size of the unit</span>
            <span class="nx">size</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Whether unit is enemy or not</span>
            <span class="nx">enemy</span><span class="o">:</span> <span class="nx">bool</span>
            <span class="c1">// Whether unit is idle or not</span>
            <span class="nx">idle</span><span class="o">:</span> <span class="nx">bool</span>
            <span class="c1">// Ground weapon max range</span>
            <span class="nx">gwrange</span><span class="o">:</span> <span class="kr">int</span>
            <span class="c1">// Air weapon max range</span>
            <span class="nx">awrange</span><span class="o">:</span> <span class="kr">int</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">// Same format as &quot;units_myself&quot;</span>
    <span class="nx">units_enemy</span><span class="o">:</span> <span class="p">...</span>
<span class="p">}</span>
</pre></div>


<h3>Analyzing TorchCraft <code>example.py</code></h3>
<p>What is TorchCraft's <a href="https://github.com/TorchCraft/TorchCraft/bilob/master/examples/py/example.py">example.py</a> actually doing?</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torchcraft</span> <span class="kn">as</span> <span class="nn">tc</span>
<span class="kn">import</span> <span class="nn">torchcraft.Constants</span> <span class="kn">as</span> <span class="nn">tcc</span>
</pre></div>


<p>Get closest function, seem very self explanatory</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_closest</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">dist</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">d</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">unit</span>
    <span class="k">return</span> <span class="n">u</span>
</pre></div>


<p>TorchCraft Python API client initial setup</p>
<div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="c1"># Initial setup</span>
<span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">([</span>
    <span class="p">[</span><span class="n">tcc</span><span class="o">.</span><span class="n">set_speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="n">tcc</span><span class="o">.</span><span class="n">set_gui</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="n">tcc</span><span class="o">.</span><span class="n">set_cmd_optim</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">])</span>
</pre></div>


<blockquote>
<p>Plays simple micro battles with an attack closest heuristic</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="k">while</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">game_ended</span><span class="p">:</span>
    <span class="n">loop</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">game_ended</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">elif</span> <span class="n">state</span><span class="o">.</span><span class="n">waiting_for_restart</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;WAITING FOR RESTART&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">my_units</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">enemy</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">units</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">battle_frame_count</span> <span class="o">%</span> <span class="n">skip_frames</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">my_units</span><span class="p">:</span>
                <span class="n">target</span> <span class="o">=</span> <span class="n">get_closest</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">enemy</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                        <span class="n">tcc</span><span class="o">.</span><span class="n">command_unit_protected</span><span class="p">,</span>
                        <span class="n">unit</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                        <span class="n">tcc</span><span class="o">.</span><span class="n">unitcommandtypes</span><span class="o">.</span><span class="n">Attack_Unit</span><span class="p">,</span>
                        <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="p">])</span>
    <span class="k">if</span> <span class="n">frames_in_battle</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">:</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">[[</span><span class="n">tc</span><span class="o">.</span><span class="n">quit</span><span class="p">]]</span>
        <span class="n">restarts</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Sending actions: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">actions</span><span class="p">))</span>
    <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<h2>Minerals and Vespene Gas</h2>
<p>Minerals are a form of crystal resource. Terran and Protoss melt these minerals down to create the armored hulls of starships, behicles and personal armor. Even the <code>Zerg</code> require minerals to harder their caparaces and develop strong lungs.</p>
<p>Extracting minerals takes time and the specilized equipment or anatomy found on SCVs, probes and drones.</p>
<p>Workers mine 8 minerals per trip. Minerals are the more important of the two physical resources, for all units produces from buildings or larvae require at least some minerals to be produces, while more basic units and structures do not require <code>Vespene Gas</code>. In addition, gas harvesting is possible only by building a gas-extracting structure on a geyser (<code>Extractor</code> for <code>Zerg</code>, <code>Refinery</code> for <code>Terran</code> and <code>Assimilator</code> for <code>Protoss</code>).</p>
<h3>Gathering Minerals</h3>
<div class="highlight"><pre><span></span>TBD
</pre></div>


<p>if all went well, the workers should now start gathering the mineral patches closest to them!</p>
<div class="highlight"><pre><span></span>TBD
</pre></div>


<p>Don't expect an optimal spread of workers, but that is left as an exercise.</p>
<h2>We Require More Vespene Gas</h2>
<h3>Build a Refinery</h3>
<div class="highlight"><pre><span></span>TBD
</pre></div>


<p>Next we will <a href="https://spacebeam.org/2020/07/11/8-supply-11-gas-12-rax-14-scout/">train different units</a> to improve our Terran skills!</p>
      </div>
      <div class="back-to-top">
          <a href="#top">back to top</a>
      </div>
      <div id="disqus_thread"></div>
        <script>
        (function() {
              var d = document, s = d.createElement('script');
              s.src = 'https://spacebeam.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </article>
  </div>
<!-- end article -->
                <footer>
                    <div class="icons">
                        <a href="https://twitter.com/SpacebeamOrg" target="_blank"><div class="icon-twitter icon"></div></a>
                        <a href="https://github.com/spacebeam" target="_blank"><div class="icon-github icon"></div></a>
                    </div>
                    <p>© <script>document.write(moment().format('YYYY'));</script> Spacebeam Community</p>
                </footer>
        </div>
</body>
</html>