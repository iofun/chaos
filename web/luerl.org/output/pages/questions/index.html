<!DOCTYPE html>
<html lang="en">
<head>
          <title>Luerl: Lua in Erlang</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta charset="utf-8" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Luerl: Lua in Erlang Full Atom Feed" />
        <!-- twitter card metadata -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/luerl.png">
<meta name="twitter:site" content="@rvirding">
<meta name="twitter:title" content="Questions">
<meta name="twitter:description" content="">
        <!-- OG Tags -->
<meta property="og:url" content="/pages/questions/"/>
<meta property="og:title" content="Luerl: Lua in Erlang | Questions" />
<meta property="og:description" content="" />
        <!-- favicon -->
        <link rel="icon" type="image/png" href="/images/luerl.png">
        <!-- moment.js for date formatting -->
        <script src="/theme/js/moment.js"></script>
        <!-- css -->
        <link rel="stylesheet" type="text/css" href="/theme/css/main.css" />
		<script>
			
                /*! grunt-grunticon Stylesheet Loader - v2.1.2 | https://github.com/filamentgroup/grunticon | (c) 2015 Scott Jehl, Filament Group, Inc. | MIT license. */
    
    (function(e){function t(t,n,r,o){"use strict";function a(){for(var e,n=0;u.length>n;n++)u[n].href&&u[n].href.indexOf(t)>-1&&(e=!0);e?i.media=r||"all":setTimeout(a)}var i=e.document.createElement("link"),l=n||e.document.getElementsByTagName("script")[0],u=e.document.styleSheets;return i.rel="stylesheet",i.href=t,i.media="only x",i.onload=o||null,l.parentNode.insertBefore(i,l),a(),i}var n=function(r,o){"use strict";if(r&&3===r.length){var a=e.navigator,i=e.Image,l=!(!document.createElementNS||!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect||!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")||e.opera&&-1===a.userAgent.indexOf("Chrome")||-1!==a.userAgent.indexOf("Series40")),u=new i;u.onerror=function(){n.method="png",n.href=r[2],t(r[2])},u.onload=function(){var e=1===u.width&&1===u.height,a=r[e&&l?0:e?1:2];n.method=e&&l?"svg":e?"datapng":"png",n.href=a,t(a,null,null,o)},u.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",document.documentElement.className+=" grunticon"}};n.loadCSS=t,e.grunticon=n})(this);(function(e,t){"use strict";var n=t.document,r="grunticon:",o=function(e){if(n.attachEvent?"complete"===n.readyState:"loading"!==n.readyState)e();else{var t=!1;n.addEventListener("readystatechange",function(){t||(t=!0,e())},!1)}},a=function(e){return t.document.querySelector('link[href$="'+e+'"]')},c=function(e){var t,n,o,a,c,i,u={};if(t=e.sheet,!t)return u;n=t.cssRules?t.cssRules:t.rules;for(var l=0;n.length>l;l++)o=n[l].cssText,a=r+n[l].selectorText,c=o.split(");")[0].match(/US\-ASCII\,([^"']+)/),c&&c[1]&&(i=decodeURIComponent(c[1]),u[a]=i);return u},i=function(e){var t,o,a;o="data-grunticon-embed";for(var c in e)if(a=c.slice(r.length),t=n.querySelectorAll(a+"["+o+"]"),t.length)for(var i=0;t.length>i;i++)t[i].innerHTML=e[c],t[i].style.backgroundImage="none",t[i].removeAttribute(o);return t},u=function(t){"svg"===e.method&&o(function(){i(c(a(e.href))),"function"==typeof t&&t()})};e.embedIcons=i,e.getCSS=a,e.getIcons=c,e.ready=o,e.svgLoadedCallback=u,e.embedSVG=u})(grunticon,this);
                
                grunticon(["/theme/css/icons.data.svg.css", "/theme/css/icons.data.png.css", "/theme/css/icons.fallback.css"]);
            </script>
        <noscript><link href="/theme/css/icons.fallback.css" rel="stylesheet"></noscript>
        <!-- menu toggle javascript -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", initMenu);
            
            function initMenu(){
                var menu = document.getElementById("menu");
                var menulink = document.getElementById("menu-link");
                menulink.addEventListener("click", function toggleMenu(){
                        window.event.preventDefault();
                        menulink.classList.toggle('active');
                        menu.classList.toggle('active');              
                    });
            };
        </script>



</head>
<body>
    <div role="banner" id="masthead">
        <header>
            <a href="/"><img src="/images/luerl.png" alt="McManus Logo"></a>
            <a href="#menu" id="menu-link">more stuff</a>
            <nav id="menu">
                <ul>
                        <li><a href="/pages/about/">about</a></li>
                        <li><a href="/pages/community/">community</a></li>
                        <li class="active"><a href="/pages/questions/">questions</a></li>
                        <li><a href="/pages/showroom/">showroom</a></li>
                </ul>
            </nav>
        </header>
    </div>
        <div class="page" role="main">
  <div class="article" role="article">
    <article>
        <footer>
            <a name="top"></a>
            <p>
              <time datetime=" 2019-11-08 16:20:00+01:00">
                <script>document.write(moment('2019-11-08 16:20:00+01:00').format('LL'));</script>
              </time>
            </p>
        </footer>
        <header>
          <h2>
            Questions
          </h2>
        </header>
      <div class="content">
         <h2>How does Lua call Erlang?</h2>
<p><code>i.e, Lua want to send socket through Erlang, or tell other Erlang node some information, how to do this?</code></p>
<p>You cannot directly call Erlang from the Lua inside luerl. To do this you need to define an interface module written in Erlang with functions you can call from Lua. There is a predefined way of building and loading such a module so it can be reached from Lua through a table like any other Lua function. There is also a predefined way of passing data in and out of these functions. If you look in the src directory all the modules luerl_lib_XXXX.erl are interface modules like this.</p>
<p>Sandboxing is very easy as Lua code cannot do this loading, it has to be done in the surrounding Erlang. Which makes it trivial to set up a limited environment.</p>
<h2>Howto set Lua script search path? (!)</h2>
<p>Luerl uses (package.config, loaded, preload, path, seachers, searchpath) as per the manual. At least that is the intent.</p>
<h2>Reading files</h2>
<p>Try this from the Erlang shell putting the code in a file "test.lua" then doing</p>
<p><code>1&gt; luerl:do("local local = dofile(\"test.lua\")", S0).</code></p>
<h2>it is possible in luerl to identify on which line we are now?</h2>
<p>So while a stack trace is of course possible with the current implementation it won't tell you that much. </p>
<h2>But you still have stacktrace there?</h2>
<p>Currently I have keep minimal information on the for function calls and the information is split between the luerl stack and the erlang functions it references.</p>
<p>It was never designed for doing stacktraces and would need a reworking to do it.</p>
<p>The stack traces are a problem. One reason they look like they do is that I am internally using erlang calls directly to implement lua calls which in a way hides them. I am thinking about how to fix this so we get a reasonable Lua stack trace.</p>
<h2>Luerl internal and external formats</h2>
<h2>(!) nicer names for functions that handle internal data structures (!?)</h2>
<h2>Lua coroutines in Luerl?</h2>
<p>When we have needed something like coroutines we have instead used Erlang's processes. We then run Luerl inside each process and use Erlang messages for communication and leave the scheduling to Erlang. This works very well but it is not quite the same thing and it does mean you can't just use already coroutine-based code must it must be specially written for this.</p>
<p>Another issue is that as all these "Lua processes" are running in separate Erlang processes they can't share any state.</p>
<h2>Does Luerl provide persistent data structures?</h2>
<p>Luerl is an implementation of Lua 5.3 where instead of a C API we have Erlang at the lowest level, this means you can have the full power of the Lua language at the same time that you benefit from Erlang and all it features like immutable data and the powerful OTP and BEAM VM.</p>
<p>Luerl processes live inside the Erlang environment and not in the OS and interact with an Erlang API instead of C.</p>
<h2>Is there any way to use Lua as an immutable language (thanks to luerl)?</h2>
<p><code>My understanding is that this is something that can be implemented globally on a generic way. Is this correct?</code></p>
<p>No, there are no generic global things in the Erlang environment.</p>
<p>We don't share memory, there is no global state or central thread of execution, in Luerl you could have global things that only apply to the execution of that process runing the Luerl VM but in practice is common to have more than one Lua process running and the way those interact between each other and the environment is not by reading a global state but by passing messages.</p>
<h2>how to call erlang function from lua file?</h2>
      </div>
      <div class="back-to-top">
          <a href="#top">back to top</a>
      </div>
      <div id="disqus_thread"></div>
        <script>
        (function() {
              var d = document, s = d.createElement('script');
              s.src = 'https://luerl.disqus.com/embed.js';
              s.setAttribute('data-timestamp', +new Date());
              (d.head || d.body).appendChild(s);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </article>
  </div>
<!-- end article -->
                <footer>
                    <div class="icons">
                        <a href="https://twitter.com/rvirding" target="_blank"><div class="icon-twitter icon"></div></a>
                        <a href="https://github.com/rvirding/luerl" target="_blank"><div class="icon-github icon"></div></a>
                    </div>
                    <p>© <script>document.write(moment().format('YYYY'));</script> BEAM Community</p>
                </footer>
        </div>
</body>
</html>